<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظرسنجی تکمیل شد</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-4">
        <div class="bg-success text-white text-center py-3 rounded mb-4">
            <h1><i class="bi bi-check-circle-fill me-2"></i>نظرسنجی تکمیل شد</h1>
        </div>

        <div class="alert alert-success text-center">
            <h4>متشکریم!</h4>
            <p>نظرسنجی شما با موفقیت ثبت شد و پردازش می‌شود.</p>
        </div>

        <!-- Processed Data Display -->
        {% if results.processed_data %}
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5><i class="bi bi-database me-2"></i>داده‌های پردازش شده</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% if results.processed_data.get('has_job') is not none %}
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>وضعیت شغلی (has_job):</strong>
                            <span class="badge bg-{{ 'success' if results.processed_data.get('has_job') else 'danger' }} ms-2">
                                {{ results.processed_data.get('has_job') }}
                            </span>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if results.processed_data.get('job_title') %}
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>عنوان شغل (job_title):</strong>
                            <span class="badge bg-primary ms-2">{{ results.processed_data.get('job_title') }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                {% if results.processed_data.get('from_age') or results.processed_data.get('to_age') %}
                <div class="row">
                    {% if results.processed_data.get('from_age') %}
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>سن شروع کار (from_age):</strong>
                            <span class="badge bg-secondary ms-2">{{ results.processed_data.get('from_age') }}</span>
                        </div>
                    </div>
                    {% endif %}
                    {% if results.processed_data.get('to_age') %}
                    <div class="col-md-6">
                        <div class="mb-3">
                            <strong>سن پایان کار (to_age):</strong>
                            <span class="badge bg-secondary ms-2">{{ results.processed_data.get('to_age') }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Raw Answers Display -->
        {% if results.answers %}
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5><i class="bi bi-chat-dots me-2"></i>پاسخ‌های خام (متن/فایل صوتی)</h5>
            </div>
            <div class="card-body">
                {% for question, answer in results.answers.items() %}
                <div class="mb-3 p-3 border rounded">
                    <strong class="text-primary">
                        {% if question == 'has_job' %}وضعیت شغلی: آیا شاغل هستید؟{% elif question == 'job_title' %}عنوان شغل: شغل شما چیست؟{% elif question == 'from_to_age' %}بازه سنی کار: از چه سنی تا چه سنی مشغول به کار هستید؟{% endif %}
                    </strong>
                    <br>
                    <span class="text-muted">پاسخ:</span> 
                    <span class="{{ 'text-muted' if answer.endswith('.webm') or answer.endswith('.wav') else 'text-dark' }}">
                        {% if answer.endswith('.webm') or answer.endswith('.wav') %}
                            <i class="bi bi-mic"></i> فایل صوتی: {{ answer }}
                        {% else %}
                            {{ answer }}
                        {% endif %}
                    </span>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Transcriptions Display -->
        {% if results.transcriptions %}
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5><i class="bi bi-file-text me-2"></i>متن پیاده‌سازی شده</h5>
            </div>
            <div class="card-body">
                {% for question, transcription in results.transcriptions.items() %}
                {% if transcription and transcription.strip() %}
                <div class="mb-3 p-3 border rounded">
                    <strong class="text-success">
                        {% if question == 'has_job' %}وضعیت شغلی{% elif question == 'job_title' %}عنوان شغل{% elif question == 'from_to_age' %}بازه سنی کار{% endif %}:
                    </strong>
                    <br>
                    <span class="text-muted">متن استخراج شده:</span> {{ transcription }}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="text-center">
            <a href="{{ url_for('index') }}" class="btn btn-primary btn-lg">
                <i class="bi bi-arrow-clockwise me-2"></i>نظرسنجی جدید
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>